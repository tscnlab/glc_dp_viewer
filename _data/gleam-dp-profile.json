{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "urn:gleam:profile:1.0.1",
  "name": "gleam-dp-profile",
  "title": "GLEAM Data Package Profile",
  "description": "Frictionless profile for light exposure metadata. Requires all key resources and validates their presence.",
  "version": "1.0.1",
  "type": "object",
  "allOf": [
    {
      "$ref": "https://specs.frictionlessdata.io/schemas/data-package.json"
    },
    {
      "type": "object",
      "required": [
        "resources",
        "profile"
      ],
      "properties": {
        "profile": {
          "type": "string",
          "anyOf": [
            { "const": "data-package" },
            { "pattern": "^schemas/gleam-dp-profile\\.json$" },
            { "pattern": "^gleam-dp-profile\\.json$" },
            { "pattern": "^(https?|file)://.*/gleam-dp-profile\\.json$" }
          ],
          "description": "Path/URL to the package profile, or the canonical 'data-package' alias."
        },
        "resources": {
          "type": "array",
          "description": "Frictionless resources required in the GLEAM data package. Must contain study, participants, datasets, devices, and participant_characteristics.",
          "minItems": 6,
          "items": {
            "type": "object",
            "required": ["name", "path", "profile"],
            "properties": {
              "name": {
                "type": "string",
                "description": "Name of the resource. Must match one of the required GLEAM resource names.",
                "enum": ["study", "participants", "datasets", "devices", "participant_characteristics", "light_data"]
              },
              "path": {
                "type": "string",
                "description": "Path to the resource file, relative to the datapackage.json."
              },
              "profile": {
                "type": "string",
                "anyOf": [
                  { "const": "tabular-data-resource" },
                  { "pattern": "^(.*/)?json-entity-resource\\.json$" },
                  { "pattern": "^(https?|file)://.*/json-entity-resource\\.json$" }
                ],
                "description": "Use 'tabular-data-resource' for tables; use a path/URL to 'json-entity-resource.json' for non-tabular JSON."
              },
              "format": {
                "type": "string",
                "description": "File format of the resource (e.g., csv, json)."
              },
              "mediatype": {
                "type": "string",
                "description": "Mediatype of the resource (e.g., text/csv, application/json)."
              },
              "schema": {
                "type": ["string", "object"],
                "description": "Table Schema (URI or inline) — for tabular resources only."
              },
              "jsonSchema": {
                "type": "string",
                "description": "JSON Schema path/URI — for non-tabular JSON resources only."
              }
            },
           "allOf": [
              {
                "if": { "properties": { "profile": { "const": "tabular-data-resource" } } },
                "then": {
                  "required": ["schema", "mediatype"],
                  "properties": { "mediatype": { "enum": ["text/csv", "application/json"] } }
                }
              },
              {
                "if": {
                  "properties": {
                    "profile": {
                      "anyOf": [
                        { "pattern": "json-entity-resource\\.json$" },
                        { "pattern": "^(https?|file)://.*/json-entity-resource\\.json$" }
                      ]
                    }
                  }
                },
                "then": {
                  "required": ["jsonSchema", "mediatype"],
                  "properties": { "mediatype": { "const": "application/json" } }
                }
              }
            ]
          },
          "allOf": [
            { "contains": { "properties": { "name": { "const": "study" } } } },
            { "contains": { "properties": { "name": { "const": "participants" } } } },
            { "contains": { "properties": { "name": { "const": "datasets" } } } },
            { "contains": { "properties": { "name": { "const": "devices" } } } },
            { "contains": { "properties": { "name": { "const": "participant_characteristics" } } } },
            { "contains": { "properties": { "name": { "const": "light_data" } } } }
          ]
        }
      }
    }
  ]
}
